<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/jquery-3.6.3.min.js"></script>
</head>

<body>

    <div class="box">
        <h2>å¤©æ°”é¢„æŠ¥</h2>

        <div class="inputBox"><input id="cityName" type="text" placeholder="è¯·è¾“å…¥åŸå¸‚åç§°"><button class="find">æœç´¢</button>
        </div>
        <div class="cityList">
            <span>çƒ­é—¨åŸå¸‚ï¼š</span>
            <ul class="newUl">
            </ul>
            <span class="change"><a href="javascript:;">æ¢ä¸€æ¢<img src="./images/refresh-icon.png"
                        alt=""></a></span>
        </div>
        <div class="showNav1">
            <p class="error">ğŸ˜‚è¯¶å‘€ï¼ŒæŸ¥è¯¢å¤©æ°”å‘ç”Ÿäº†é”™è¯¯ï¼Œé”™è¯¯åŸå› æ˜¯ï¼šæ•°æ®è¿”å›ä¸ºç©º</p>
        </div>
        <div class="showNav2">
            <!-- <div class="item">
                <img src="./jQueryç¬¬ä¸‰å¤©ä¸Ajaxç¬¬ä¸€å¤©ä½œä¸šç´ æ/images/dayu.png" alt="">
                <p class="weather">é›·é˜µé›¨</p>
                <p class="temp">æœ€ä½æ¸©25Â°C ~ æœ€é«˜æ¸©33Â°C</p>
                <p class="date">2021-06-09æ˜ŸæœŸä¸‰</p>
                <p class="wind">åŒ—é£</p>
                <p class="level">1-2çº§</p>
            </div> -->
        </div>
    </div>

    <script>
        /*
        æ¥å£:
            å¤©è¡Œæ•°æ®å¤©æ°”æ¥å£æ–‡æ¡£: https://www.tianapi.com/apiview/72
        */
        // çƒ­é—¨åŸå¸‚æ€»åˆ—è¡¨
        var arrCityName = [
            "åŒ—äº¬",
            "ä¸Šæµ·",
            "å¹¿å·",
            "æ·±åœ³",
            "è‹å·",
            "å¤§è¿",
            "é‡åº†",
            "æ­å·",
            "æ— é”¡",
            "å¤©æ´¥",
            "ä½›å±±",
            "å®æ³¢",
            "å—äº¬",
            "æˆéƒ½",
            "ä¸œè",
            "æ­¦æ±‰",
            "é’å²›",
            "æ²ˆé˜³",
            "çƒŸå°",
            "å”å±±",
            "æµå—",
            "å“ˆå°”æ»¨",
            "çŸ³å®¶åº„",
            "éƒ‘å·",
            "æ³‰å·",
            "æ¸©å·",
            "é•¿æ²™",
            "å—é€š",
            "é•¿æ˜¥",
            "æ½åŠ",
            "ç»å…´",
            "ç¦å·",
            "æ·„åš",
            "å¤§åº†",
            "å¸¸å·",
            "å°å·",
            "æµå®",
            "ä¸œè¥",
            "è¥¿å®‰",
            "å¾å·",
            "ä¸´æ²‚",
            "å¨æµ·",
            "å˜‰å…´",
            "é‚¯éƒ¸",
            "æ´›é˜³",
            "æ²§å·",
            "é‡‘å",
            "æ˜†æ˜",
            "å—é˜³",
            "ä¿å®š"
        ];

        // è¦æ±‚:
        // 1. HTMLCSSå¸ƒå±€
        // 2. ç‚¹å‡»æœç´¢æŒ‰é’®æˆ–è€…åœ¨è¾“å…¥æ¡†ä¸­æŒ‰ä¸‹å›è½¦,å¯ä»¥æ ¹æ®è¾“å…¥çš„åŸå¸‚åç§°,æŸ¥è¯¢å¯¹åº”åŸå¸‚çš„å¤©æ°”æ•°æ®; é»˜è®¤æ˜¾ç¤ºå¹¿å·å¤©æ°”æ•°æ®

        // ç¬¬ä¸€æ­¥: åˆ›å»ºajaxå¯¹è±¡, é€šè¿‡XMLHttpRequest()æ„é€ å‡½æ•°
        function getWeather(cityName) {
            //é‡ç½®
            $(".showNav1 .error").hide();
            $(".showNav2").html("");
            var xhr = new XMLHttpRequest();
            // console.log("xhr=>", xhr);
            xhr.open("GET", "https://apis.tianapi.com/tianqi/index?key=0986ec8d9fb94e2ba3044ad0d33d6657&city=" + cityName + "&type=7");

            xhr.send();

            xhr.onreadystatechange = function () {

                if (xhr.readyState === 4 && xhr.status === 200) {
                    // xhr.responseTextè¡¨ç¤ºajaxå¯¹è±¡è·å–æœåŠ¡å™¨è¿”å›çš„æ–‡æœ¬å€¼
                    // console.log("xhr.responseText=>", xhr.responseText);
                    // æŠŠjsonå­—ç¬¦ä¸²è½¬æˆjsonå¯¹è±¡  JSON.parse(jsonå­—ç¬¦ä¸²)
                    var res = JSON.parse(xhr.responseText)
                    
                    // console.log(res);
                    // åˆ¤æ–­æ•°æ®æ˜¯å¦æœ‰é—®é¢˜
                    if (res.code != 200) {
                          $(".showNav1 .error").show();
                          return;
                      }
                    //æ•°ç»„
                    data = res.result.list;
                       if(data != undefined){
                        var str = "";
                        data.map(function (item) {
                            str += ' <div class="item">';
                            str += '<img src="./images/' + item.weatherimg + '" alt="">';
                            str += '<p class="weather">' + item.weather + '</p>';
                            str += '<p class="temp">æœ€ä½æ¸©' + item.lowest + ' ~ æœ€é«˜æ¸©' + item.highest + '</p>';
                            str += '<p class="date">' + item.date + ' ' + item.week + '</p>';
                            str += '<p class="wind">' + item.wind + '</p>';
                            str += '<p class="level">' + item.windsc + '</p></div>';
                        });
                        // console.log(str);
                        $(".showNav2").html(str);
                       }
                    } 
            }
        }


        getWeather("å¹¿å·");

        $(".find").click(function () {
            var $cityName = $("#cityName").val();
            if ($cityName.trim().length != 0) {
                getWeather($cityName);
            } else {
                alert("è¯·è¾“å…¥åŸå¸‚å§“åä»¥åå†æŸ¥è¯¢");
                // return ;
            }
            $("#cityName").val("");
        });
        // 3. æ ¹æ®æŸ¥è¯¢åˆ°çš„æ•°æ®,æ¸²æŸ“é¡µé¢DOMç»“æ„

        // 4. ç‚¹å‡»ä»»æ„çƒ­é—¨åŸå¸‚,æŸ¥è¯¢å¯¹åº”åŸå¸‚å¤©æ°”æ•°æ®,å¹¶æ¸²æŸ“DOMç»“æ„
        // console.log();
        var newCity = [];
        arrCityName.forEach(function (item, index) {
            newCity[index] = item;
        });
        newCity = newCity.splice(0, 7);
        var newStr = "";
        newCity.forEach(function (item) {
            $(".newUl").append('<li><a href="javascript:;">' + item + '</a></li>');
        });
        $(".newUl").on("click", "a", function () {
            $(".showNav1 .error").hide();
            getWeather($(this).text());
        });


        // 5. ç‚¹å‡» "æ¢ä¸€æ¢" éšæœºåˆ‡æ¢, ä¸é‡å¤çš„7ä¸ªçƒ­é—¨åŸå¸‚, å¹¶é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªçƒ­é—¨åŸå¸‚çš„å¤©æ°”
        // console.log(arrCityName);
        $(".change").click(function () {
            $(".newUl").html("");
            //ä¹±åº
            arrCityName.sort(function () {
                return Math.random() - 0.5;
            });
            // console.log("æ‰“ä¹±ä»¥åçš„æ•°ç»„newCity=>", arrCityName);
            // ä»æ‰“ä¹±çš„æ•°ç»„ä¸­å–å‡º7ä¸ªæ•°ç»„å…ƒç´ 
            var showCity = arrCityName.slice(0, 7);
            // console.log(showCity);
            var newStr = "";
            showCity.forEach(function (item) {

                $(".newUl").append('<li><a href="javascript:;">' + item + '</a></li>');
                getWeather(showCity[0]);
            });

        });
            // 6. å¦‚æœæŸ¥è¯¢ä¸åˆ°åŸå¸‚å¤©æ°”æ•°æ®,æ˜¾ç¤ºæç¤ºä¿¡æ¯

            // 7. å¦‚æœæ–‡æœ¬æ¡†è¾“å…¥å†…å®¹ä¸ºç©º,å¼¹çª—æç¤º,ä¸æŸ¥è¯¢  (5åˆ†)

    </script>
</body>

</html>